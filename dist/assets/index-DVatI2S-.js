var c=Object.defineProperty;var f=(e,t,r)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var n=(e,t,r)=>f(e,typeof t!="symbol"?t+"":t,r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function r(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(i){if(i.ep)return;i.ep=!0;const l=r(i);fetch(i.href,l)}})();const o={DIGIT:"digit",DECIMAL:"decimal",OP:"op",EQUAL:"equal",CLEAR:"clear"};var s=(e=>(e[e.Ready=0]="Ready",e[e.InputtingFirst=1]="InputtingFirst",e[e.OperatorEntered=2]="OperatorEntered",e[e.InputtingSecond=3]="InputtingSecond",e[e.Error=4]="Error",e[e.ResultShown=5]="ResultShown",e))(s||{});class u{}n(u,"MAX_EXP_DIGITS",8),n(u,"ERROR_MESSAGE","エラー"),n(u,"NUMBER_ZERO","0");var h=(e=>(e.Add="+",e.Subtract="-",e.Multiply="×",e.Divide="÷",e))(h||{});class g{constructor(t){this.maxDigits=t}formatForDisplay(t){if(isNaN(t))return"エラー";const r=10**this.maxDigits,a=Math.round(t*r)/r;let i=a.toString();return i.includes(".")&&(i=i.replace(/\.?0+$/,"")),i.replace(".","").length>this.maxDigits&&(i=a.toExponential(this.maxDigits-1)),i}}class y extends Error{constructor(t="Division by zero"){super(t),this.name="DivisionByZeroError"}}class b{operatorSwitch(t,r,a){switch(r){case h.Add:return t+a;case h.Subtract:return t-a;case h.Multiply:return t*a;case h.Divide:if(a===0)throw new y("Divide by zero");return t/a}}}class E{constructor(t,r=""){this.maxDigits=t,this.value=r}pushDigit(t){if(!(this.digitCount()>=this.maxDigits)&&!(t==="."&&this.value.includes("."))){if(this.value==="0"&&t!=="0"){this.value=t;return}this.value+=t}}pushDecimal(){this.value===""?this.value="0.":this.value.includes(".")||(this.value+="."),console.log(this.value)}clear(){return this.value=""}toNumber(){return Number(this.value||0)}toString(){return this.value}digitCount(){return this.value.replace(/[.\-]/g,"").length}hasValue(){const t=this.value.toString();if(t===""||t==="-")return!1;const r=Number(t);return!isNaN(r)}}class O{constructor(t,r=new g(u.MAX_EXP_DIGITS),a=new b,i=new E(u.MAX_EXP_DIGITS)){n(this,"state",s.Ready);n(this,"left",null);n(this,"operator",null);n(this,"lastResult",null);n(this,"lastOperator",null);this.display=t,this.formatter=r,this.evaluator=a,this.buffer=i}handle(t){switch(t.kind){case o.DIGIT:this.handleDigit(t.value);break;case o.DECIMAL:this.buffer.pushDecimal(),this.display.render(this.buffer.toString());break;case o.OP:this.handleOperator(t.value);break;case o.EQUAL:this.handleEqual();break;case o.CLEAR:this.handleClear();break}}handleDigit(t){switch(this.state){case s.Ready:{this.buffer.pushDigit(t.toString()),this.display.render(this.buffer.toString()),this.display.displayHistoryOne(this.buffer.toString()),this.state=s.InputtingFirst;break}case s.InputtingFirst:{this.buffer.pushDigit(t.toString()),this.display.render(this.buffer.toString()),this.display.displayHistoryOne(this.buffer.toString());break}case s.InputtingSecond:{this.buffer.pushDigit(t.toString()),this.display.render(this.buffer.toString()),this.display.displayHistoryTwo(this.buffer.toString());break}case s.OperatorEntered:{this.buffer.pushDigit(t.toString()),this.display.render(this.buffer.toString()),this.display.displayHistoryTwo(this.buffer.toString()),this.state=s.InputtingSecond;break}case s.ResultShown:{this.historyClear(),this.buffer.clear(),this.operator=null,this.left=null,this.buffer.pushDigit(t.toString()),this.display.render(this.buffer.toString()),this.display.displayHistoryOne(this.buffer.toString()),this.state=s.InputtingFirst;break}case s.Error:{this.buffer.clear(),this.operator=null,this.left=null,this.buffer.pushDigit(t.toString()),this.display.render(this.buffer.toString()),this.display.displayHistoryOne(this.buffer.toString()),this.state=s.InputtingFirst;break}}}handleOperator(t){const r=this.buffer.toString();switch(this.state){case s.Ready:{if(t===h.Subtract&&r===""&&this.left===null){this.buffer.pushDigit("-"),this.display.render("-"),this.display.displayHistoryOne("-"),this.state=s.InputtingFirst;return}return}case s.InputtingFirst:{if(r===""){this.state=s.Ready;return}this.left=this.buffer.toNumber(),this.operator=t,this.buffer.clear(),this.display.displayHistoryOperator(t),this.state=s.OperatorEntered;return}case s.InputtingSecond:case s.OperatorEntered:{if(r===""&&this.left!==null){this.operator=t,this.display.displayHistoryOperator(t);return}this.operator&&this.handleEqual(),this.operator=t,this.buffer.clear(),this.display.displayHistoryOperator(t),this.state=s.OperatorEntered;return}default:return}}handleEqual(){switch(this.state){case s.Ready:case s.InputtingFirst:case s.InputtingSecond:{let t=this.buffer.toNumber();if(this.operator===null&&this.buffer.hasValue()&&this.left===null){this.display.render(this.buffer.toString()),this.state=s.ResultShown;return}if(this.left===null&&!this.buffer.hasValue()&&this.operator===null){this.handleClear(),this.state=s.Ready;return}const r=Number(this.left),a=t;if(isNaN(r)||isNaN(a)){this.display.renderError(u.ERROR_MESSAGE),this.state=s.Error;return}try{this.handleEvaluation(r,this.operator,a)}catch(i){this.handleError(i)}finally{console.log("try-catch-finally終了！！")}return}case s.ResultShown:{if(this.lastOperator===null||this.lastResult===null)return;try{this.handleEvaluation(Number(this.left),this.lastOperator,this.lastResult)}catch(t){this.handleError(t)}finally{console.log("try-catch-finally終了！！")}return}case s.OperatorEntered:{if(!this.buffer.hasValue()&&this.operator){this.display.renderError(u.ERROR_MESSAGE),this.historyClear(),this.state=s.Error;return}return}default:return}}handleClear(){this.buffer.clear(),this.left=null,this.operator=null;const t=document.getElementById("result");t&&(t.textContent=u.NUMBER_ZERO),this.historyClear(),this.state=s.Ready}handleError(t){t instanceof y?(this.display.renderError("エラー"),this.historyClear(),console.error("Division by zero detected.")):(this.display.renderError("不明なエラー"),this.historyClear(),console.error(t)),this.state=s.Error}handleEvaluation(t,r,a){const i=this.evaluator.operatorSwitch(t,r,a),l=this.formatter.formatForDisplay(i);if(this.lastOperator=r,this.lastResult=a,this.operator=null,this.left=i,this.display.render(l),this.state===s.ResultShown){const d=Number(l)-this.lastResult;this.display.displayHistoryOne(d.toString()),this.display.displayHistoryOperator(this.lastOperator),this.display.displayHistoryTwo(this.lastResult.toString())}else this.display.displayHistoryOne(l),this.display.displayHistoryOperator(this.buffer.clear()),this.display.displayHistoryTwo(this.buffer.clear());this.state=s.ResultShown}historyClear(){this.display.displayHistoryOne(this.buffer.clear()),this.display.displayHistoryOperator(this.buffer.clear()),this.display.displayHistoryTwo(this.buffer.clear())}}class S{constructor(){n(this,"displayResultEl",document.getElementById("result"));n(this,"historyElOne",document.getElementById("history-one"));n(this,"historyOperator",document.getElementById("history-operator"));n(this,"historyElTwo",document.getElementById("history-two"))}render(t){this.displayResultEl.textContent=t}renderError(t){this.displayResultEl.textContent=t}displayHistoryOne(t){this.historyElOne.textContent=t}displayHistoryOperator(t){this.historyOperator.textContent=t}displayHistoryTwo(t){this.historyElTwo.textContent=t}}class m{constructor(){n(this,"keyMap",new Map);for(let t=0;t<=9;t++)this.keyMap.set(t.toString(),{kind:o.DIGIT,value:t}),this.keyMap.set(".",{kind:o.DECIMAL}),this.keyMap.set("+",{kind:o.OP,value:h.Add}),this.keyMap.set("-",{kind:o.OP,value:h.Subtract}),this.keyMap.set("×",{kind:o.OP,value:h.Multiply}),this.keyMap.set("÷",{kind:o.OP,value:h.Divide}),this.keyMap.set("=",{kind:o.EQUAL}),this.keyMap.set("C",{kind:o.CLEAR})}resolve(t){const r=t.dataset.key??t.innerText;return this.keyMap.get(r)}}const v=new S,p=new O(v),D=new m,I=document.querySelectorAll("button");I.forEach(e=>{e.addEventListener("click",t=>{try{const r=D.resolve(t.target);if(!r)throw new Error("無効なボタンが押下されました！");p.handle(r)}catch(r){p.handleError(r)}})});
