(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&a(h)}).observe(document,{childList:!0,subtree:!0});function s(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(i){if(i.ep)return;i.ep=!0;const l=s(i);fetch(i.href,l)}})();const n={DIGIT:"digit",DECIMAL:"decimal",OP:"op",EQUAL:"equal",CLEAR:"clear"};var e=(r=>(r[r.Ready=0]="Ready",r[r.InputtingFirst=1]="InputtingFirst",r[r.OperatorEntered=2]="OperatorEntered",r[r.InputtingSecond=3]="InputtingSecond",r[r.Error=4]="Error",r[r.ResultShown=5]="ResultShown",r))(e||{});class u{static MAX_EXP_DIGITS=8;static ERROR_MESSAGE="エラー";static NUMBER_ZERO="0"}var o=(r=>(r.Add="+",r.Subtract="-",r.Multiply="×",r.Divide="÷",r))(o||{});class p{constructor(t){this.maxDigits=t}formatForDisplay(t){if(isNaN(t))return"エラー";const s=10**this.maxDigits,a=Math.round(t*s)/s;let i=a.toString();return i.includes(".")&&(i=i.replace(/\.?0+$/,"")),i.replace(".","").length>this.maxDigits&&(i=a.toExponential(this.maxDigits-1)),i}}class f extends Error{constructor(t="Division by zero"){super(t),this.name="DivisionByZeroError"}}class y{operatorSwitch(t,s,a){switch(s){case o.Add:return t+a;case o.Subtract:return t-a;case o.Multiply:return t*a;case o.Divide:if(a===0)throw new f("Divide by zero");return t/a}}}class c{constructor(t,s=""){this.maxDigits=t,this.value=s}pushDigit(t){if(!(this.digitCount()>=this.maxDigits)&&!(t==="."&&this.value.includes("."))){if(this.value==="0"&&t!=="0"){this.value=t;return}this.value+=t}}pushDecimal(){this.value===""?this.value="0.":this.value.includes(".")||(this.value+="."),console.log(this.value)}clear(){return this.value=""}toNumber(){return Number(this.value||0)}toString(){return this.value}digitCount(){return this.value.replace(/[.\-]/g,"").length}hasValue(){const t=this.value.toString();if(t===""||t==="-")return!1;const s=Number(t);return!isNaN(s)}}class g{constructor(t,s=new p(u.MAX_EXP_DIGITS),a=new y,i=new c(u.MAX_EXP_DIGITS)){this.display=t,this.formatter=s,this.evaluator=a,this.buffer=i}state=e.Ready;left=null;operator=null;lastResult=null;lastOperator=null;handle(t){switch(t.kind){case n.DIGIT:this.handleDigit(t.value);break;case n.DECIMAL:this.buffer.pushDecimal(),this.display.render(this.buffer.toString());break;case n.OP:this.handleOperator(t.value);break;case n.EQUAL:this.handleEqual();break;case n.CLEAR:this.handleClear();break}}handleDigit(t){switch(this.state){case e.Ready:{this.buffer.pushDigit(t.toString()),this.display.render(this.buffer.toString()),this.display.displayHistoryOne(this.buffer.toString()),this.state=e.InputtingFirst;break}case e.InputtingFirst:{this.buffer.pushDigit(t.toString()),this.display.render(this.buffer.toString()),this.display.displayHistoryOne(this.buffer.toString());break}case e.InputtingSecond:{this.buffer.pushDigit(t.toString()),this.display.render(this.buffer.toString()),this.display.displayHistoryTwo(this.buffer.toString());break}case e.OperatorEntered:{this.buffer.pushDigit(t.toString()),this.display.render(this.buffer.toString()),this.display.displayHistoryTwo(this.buffer.toString()),this.state=e.InputtingSecond;break}case e.ResultShown:{this.historyClear(),this.buffer.clear(),this.operator=null,this.left=null,this.buffer.pushDigit(t.toString()),this.display.render(this.buffer.toString()),this.display.displayHistoryOne(this.buffer.toString()),this.state=e.InputtingFirst;break}case e.Error:{this.buffer.clear(),this.operator=null,this.left=null,this.buffer.pushDigit(t.toString()),this.display.render(this.buffer.toString()),this.display.displayHistoryOne(this.buffer.toString()),this.state=e.InputtingFirst;break}}}handleOperator(t){const s=this.buffer.toString();switch(this.state){case e.Ready:{if(t===o.Subtract&&s===""&&this.left===null){this.buffer.pushDigit("-"),this.display.render("-"),this.display.displayHistoryOne("-"),this.state=e.InputtingFirst;return}return}case e.InputtingFirst:{if(s===""){this.state=e.Ready;return}this.left=this.buffer.toNumber(),this.operator=t,this.buffer.clear(),this.display.displayHistoryOperator(t),this.state=e.OperatorEntered;return}case e.InputtingSecond:case e.OperatorEntered:{if(s===""&&this.left!==null){this.operator=t,this.display.displayHistoryOperator(t);return}this.operator&&this.handleEqual(),this.operator=t,this.buffer.clear(),this.display.displayHistoryOperator(t),this.state=e.OperatorEntered;return}default:return}}handleEqual(){switch(this.state){case e.Ready:case e.InputtingFirst:case e.InputtingSecond:{let t=this.buffer.toNumber();if(this.operator===null&&this.buffer.hasValue()&&this.left===null){this.display.render(this.buffer.toString()),this.state=e.ResultShown;return}if(this.left===null&&!this.buffer.hasValue()&&this.operator===null){this.handleClear(),this.state=e.Ready;return}const s=Number(this.left),a=t;if(isNaN(s)||isNaN(a)){this.display.renderError(u.ERROR_MESSAGE),this.state=e.Error;return}try{this.handleEvaluation(s,this.operator,a)}catch(i){this.handleError(i)}finally{console.log("try-catch-finally終了！！")}return}case e.ResultShown:{if(this.lastOperator===null||this.lastResult===null)return;try{this.handleEvaluation(Number(this.left),this.lastOperator,this.lastResult)}catch(t){this.handleError(t)}finally{console.log("try-catch-finally終了！！")}return}case e.OperatorEntered:{if(!this.buffer.hasValue()&&this.operator){this.display.renderError(u.ERROR_MESSAGE),this.historyClear(),this.state=e.Error;return}return}default:return}}handleClear(){this.buffer.clear(),this.left=null,this.operator=null;const t=document.getElementById("result");t&&(t.textContent=u.NUMBER_ZERO),this.historyClear(),this.state=e.Ready}handleError(t){t instanceof f?(this.display.renderError("エラー"),this.historyClear(),console.error("Division by zero detected.")):(this.display.renderError("不明なエラー"),this.historyClear(),console.error(t)),this.state=e.Error}handleEvaluation(t,s,a){const i=this.evaluator.operatorSwitch(t,s,a),l=this.formatter.formatForDisplay(i);if(this.lastOperator=s,this.lastResult=a,this.operator=null,this.left=i,this.display.render(l),this.state===e.ResultShown){const h=Number(l)-this.lastResult;this.display.displayHistoryOne(h.toString()),this.display.displayHistoryOperator(this.lastOperator),this.display.displayHistoryTwo(this.lastResult.toString())}else this.display.displayHistoryOne(l),this.display.displayHistoryOperator(this.buffer.clear()),this.display.displayHistoryTwo(this.buffer.clear());this.state=e.ResultShown}historyClear(){this.display.displayHistoryOne(this.buffer.clear()),this.display.displayHistoryOperator(this.buffer.clear()),this.display.displayHistoryTwo(this.buffer.clear())}}class b{displayResultEl=document.getElementById("result");historyElOne=document.getElementById("history-one");historyOperator=document.getElementById("history-operator");historyElTwo=document.getElementById("history-two");render(t){this.displayResultEl.textContent=t}renderError(t){this.displayResultEl.textContent=t}displayHistoryOne(t){this.historyElOne.textContent=t}displayHistoryOperator(t){this.historyOperator.textContent=t}displayHistoryTwo(t){this.historyElTwo.textContent=t}}class E{keyMap=new Map;constructor(){for(let t=0;t<=9;t++)this.keyMap.set(t.toString(),{kind:n.DIGIT,value:t}),this.keyMap.set(".",{kind:n.DECIMAL}),this.keyMap.set("+",{kind:n.OP,value:o.Add}),this.keyMap.set("-",{kind:n.OP,value:o.Subtract}),this.keyMap.set("×",{kind:n.OP,value:o.Multiply}),this.keyMap.set("÷",{kind:n.OP,value:o.Divide}),this.keyMap.set("=",{kind:n.EQUAL}),this.keyMap.set("C",{kind:n.CLEAR})}resolve(t){const s=t.dataset.key??t.innerText;return this.keyMap.get(s)}}const O=new b,d=new g(O),S=new E,m=document.querySelectorAll("button");m.forEach(r=>{r.addEventListener("click",t=>{try{const s=S.resolve(t.target);if(!s)throw new Error("無効なボタンが押下されました！");d.handle(s)}catch(s){d.handleError(s)}})});
